# 요구사항 정리

1. [공통](#1-공통)
2. [상품](#2-상품)
3. [브랜드](#3-브랜드)
4. [좋아요](#4-좋아요)
5. [주문](#5-주문)

---

## 1. 공통

#### 기능적 요구사항

_Happy Path_

- 존재하지 않는 페이지를 요청하면 빈 목록을 반환한다.
  - 목록 조회는 페이지당 조회 개수를 선택할 수 있다.
- 모든 목록 조회 시
  - 정렬 기준을 선택할 수 있다.
  - 검색 조건을 선택할 수 있다.
  - 필터링 조건을 선택할 수 있다.

_Fail Cases_

- 목록 조회 시,
  - 잘못된 페이지당 개수를 요청하면 오류를 반환한다.
  - 잘못된 정렬 기준을 요청하면 오류를 반환한다.
  - 잘못된 검색 조건을 요청하면 오류를 반환한다.
  - 잘못된 필터링 조건을 요청하면 오류를 반환한다.
- 상세 조회 시,
  - 존재하지 않는 ID를 요청하면 오류를 반환한다.
  - 잘못된 ID 형식을 요청하면 오류를 반환한다.

#### 비기능적 요구사항

- 사용자 인증은 `X-USER-ID` Header 기반으로 처리된다.
- 페이지당 개수는 기본 정책을 10개, 20개, 50개이다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야 한다.

  | 케이스                 | 설명                                    | HTTP 상태코드             |
  | ---------------------- | --------------------------------------- | ------------------------- |
  | 비로그인 사용자의 요청 | 인증 헤더 없음, 해당 유저 존재하지 않음 | 401 UNAUTHORIZED          |
  | 권한 없는 요청         | 다른 사용자의 주문 정보 조회 등         | 403 FORBIDDEN             |
  | 존재하지 않는 ID 요청  | 잘못된 ID 형식                          | 404 NOT FOUND             |
  | 잘못된 페이지당 개수   | 잘못된 pageSize                         | 400 BAD REQUEST           |
  | 잘못된 정렬 기준       | 잘못된 sortType                         | 400 BAD REQUEST           |
  | 잘못된 검색 조건       | 잘못된 searchType                       | 400 BAD REQUEST           |
  | 잘못된 필터링 조건     | 잘못된 filterType                       | 400 BAD REQUEST           |
  | 조회 중 예외           | DB 연결 실패 등                         | 500 Internal Server Error |

---

## 2. 상품

### 2.1 상품 목록

#### 기능적 요구사항

_Happy Path_

- 상품 목록 조회 기능은 **[공통](#1-공통)의 목록 조회 정책**을 따른다.
- **상품 목록에 특화된 조회 조건**은 다음과 같다.
  - **정렬:** 가격순, 최신순, 인기순을 지원한다.
  - **검색:** 상품명, 브랜드명으로 검색할 수 있다.
  - **필터링:** 브랜드, 품목(카테고리), 품절 여부로 필터링할 수 있다.
  - **응답 정보:**
    - 상품명, 가격, 재고, 브랜드명, 카테고리, 좋아요 수, 이미지 URL 등을 포함한다.
    - **로그인 시** 좋아요 여부
      - (상세 기능은 **[좋아요](#4-좋아요) 도메인 요구사항**을 따른다)

_Fail Cases_

- ([공통](#1-공통) 섹션 참조)

#### 비기능적 요구사항

- ([공통](#1-공통) 섹션 참조)

### 2.2 상품 상세

#### 기능적 요구사항

_Happy Path_

- 상품 상세 정보를 조회할 수 있다.
  - 상품명, 카테고리, 가격, 브랜드명, 상세 설명, 상품 이미지 등을 포함한다.
  - 상품의 재고 상태(품절 여부)를 포함한다.
  - 상품의 좋아요 수를 포함한다.
  - **로그인한 사용자만** 해당 상품에 대한 좋아요 여부를 알 수 있다.
    - (상세 기능은 **[좋아요](#4-좋아요) 도메인 요구사항**을 따른다)

_Fail Cases_

- ([공통](#1-공통) 섹션 참조)

#### 비기능적 요구사항

- ([공통](#1-공통) 섹션 참조)

---

## 3. 브랜드

### 기능적 요구사항

_Happy Path_

- 브랜드 목록 조회 기능은 **[공통](#1-공통)의 목록 조회 정책**을 따른다.
- **브랜드 목록에 특화된 조회 조건**은 다음과 같다.
  - **정렬:** 가나다순, 인기순, 최신순을 지원한다.
  - **응답 정보:** 브랜드명, 브랜드 이미지를 포함한다.
- **브랜드 상세 정보**를 조회할 수 있으며, 상세 정보에는 브랜드의 상품 목록으로 바로 이동할 수 있는 링크를 포함할 수 있다.

_Fail Cases_

- ([공통](#1-공통) 섹션 참조)

#### 비기능적 요구사항

- ([공통](#1-공통) 섹션 참조)

---

## 4. 좋아요

#### 기능적 요구사항

_Happy Path_

- 상품에 좋아요를 할 수 있다.
  - **로그인한 사용자만** 좋아요를 할 수 있다.
  - 좋아요를 취소할 수 있다.
- **로그인한 사용자만** 자신이 좋아요한 상품 목록을 조회할 수 있다.
  - 좋아요한 상품 목록 조회 기능은 **[공통](#1-공통)의 목록 조회 정책**을 따른다.
  - **정렬:** 최신순, 좋아요 누른 순, 인기순을 지원한다.
  - **응답 정보:** (상품 목록과 동일)
    - 상품명, 가격, 재고, 브랜드명, 카테고리, 좋아요 수, 이미지 URL 등을 포함한다.

_Fail Cases_

- 로그인하지 않은 사용자가 좋아요를 요청하면 오류를 반환한다.
- 존재하지 않는 상품에 좋아요를 요청하면 오류를 반환한다.

#### 비기능적 요구사항

- 좋아요 요청 및 취소 요청은 멱등적이어야 한다.
- 상품의 '총 좋아요 수'는 조회 시 동적으로 계산한다. 향후 트래픽 증가에 따른 성능 저하 발생 시, products 테이블에 likes_count 컬럼을 추가하고 비동기 또는 배치 처리를 통해 비정규화하는 방안을 고려할 수 있다.
- ([공통](#1-공통) 섹션 참조)

---

## 5. 주문

### 기능적 요구사항

_Happy Path_

- **로그인한 사용자만** 주문을 할 수 있다.
- 상품 목록에서 선택한 상품들을 주문할 수 있다.
- 주문할 때,
  - 각 상품의 재고를 차감한다.
  - 보유한 포인트에서 결제 금액만큼 차감한다.
- 주문에 성공하면 주문 상세 내역을 조회할 수 있다.
- 주문 내역은 주문 ID, 주문한 상품 목록, 총 결제 금액, 주문 상태(예: 대기중, 완료, 취소 등)를 포함한다.
- **로그인한 사용자 자신의 주문 내역 및 목록만** 조회할 수 있다.
- 주문 내역 목록 조회 기능은 **[공통](#1-공통)의 목록 조회 정책**을 따른다.
  - **정렬:** 기본적으로 최신순으로 정렬되며, 결제 금액순으로도 정렬할 수 있다.
  - **검색:** 주문한 상품명, 브랜드명 등으로 검색할 수 있다.
  - **필터링:** 주문 상태로 필터링할 수 있다.
  - **응답 정보:**
    - 주문 ID, 총 결제 금액, 주문 상태, 주문 날짜 등을 포함한다.

_Fail Cases_

- 로그인하지 않은 사용자가 주문을 요청하면 오류를 반환한다.
- 주문할 때,
  - 재고가 부족한 상품이 있으면 오류를 반환한다.
  - 주문 금액이 보유 포인트를 초과하면 오류를 반환한다.
  - 주문할 상품이 존재하지 않는 경우(없는 상품) 오류를 반환한다.

#### 비기능적 요구사항

#### 비기능적 요구사항

- 주문 생성 과정에서 결제 시스템 연동을 고려하여 주문과 결제의 책임은 분리한다.
- **결제 성공 후, 주문 상태 변경과 재고 차감은 하나의 트랜잭션으로 처리되어 원자성을 보장해야 한다.**
- **_데이터 정합성 문제에 대한 해결책 고민 필요_**
- 주문 상태는 대기중(PENDING), 완료(COMPLETED), 실패(FAILED) 등으로 관리된다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러메세지를 반환해야 한다.

  | 케이스                | 설명             | HTTP 상태코드   |
  | --------------------- | ---------------- | --------------- |
  | 재고 부족 주문 요청   | 재고 부족        | 409 CONFLICT    |
  | 포인트 초과 주문 요청 | 보유 포인트 부족 | 400 BAD REQUEST |
